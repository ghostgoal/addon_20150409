<html>
<head>
    <script src="/js/jquery.js"></script>
</head>
<body>
 <form id="bt" name="some_name" action="/demo/upload.php" method="post" enctype="multipart/form-data">

    <input type="file"  multiple name="f[]" id='f'></input>
    <input type="submit" value="Send All" />
    <input id="start_bt" type="button" value="Send"/>
</form>
<div id="content">
</div>
<hr/>
<div id="result"/>
<script type="text/javascript">
    var show_bt = function( fl){

        $("#content").html("");

        for(var i =0;i <fl.length;i ++)
        {
            var c = '<input type="checkbox" fi="'+i+'" checked/><span>'+fl[i].name+"</span><br>";

            $("#content").append(c);

        }   


    }
    $("#start_bt").click(function(){
        var fl = $("#f")[0];
        var form = new FormData();
        if(!form) return;
//        alert(fl);
	fl=fl.files;
        $("#content>:checkbox").each(function(i){
//            alert(this.checked);
            if(this.checked){
//                alert($(this).attr("fi"));
                var index = $(this).attr("fi");
                form.append("f[]",fl[index]);
//                alert(form);
            }
        })

        var xhr = new XMLHttpRequest();

        xhr.open("post","/demo/upload.php", true);

        xhr.onload = function () {

//            alert("上传完成!");
             $("#result").html(xhr.responseText);
        };

        xhr.send(form);
//        $("#content").load("/demo/upload.php"); 
//        alert("ok");
    })
 
    $("#bt").append("<hr>");
    var dump = function(i){ for(var k in i){alert(k);}}
    $("#f").change(function(){$("#result").html("");show_bt(this.files);});
</script>
</body>
</html>
